<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Architecture Test - TeamSite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/utils.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/data-manager.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Data Architecture Test</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Data Status -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Data Status</h2>
                <div id="dataStatus" class="space-y-2">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- Test Operations -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Test Operations</h2>
                <div class="space-y-3">
                    <button onclick="testAddPlayer()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        Add Test Player
                    </button>
                    <button onclick="testUpdatePlayer()" class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        Update Player
                    </button>
                    <button onclick="testDeletePlayer()" class="w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                        Delete Player
                    </button>
                    <button onclick="testExportData()" class="w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                        Export Data
                    </button>
                    <button onclick="testResetData()" class="w-full bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                        Reset to Defaults
                    </button>
                </div>
            </div>

            <!-- Players List -->
            <div class="bg-white p-6 rounded-lg shadow md:col-span-2">
                <h2 class="text-xl font-semibold mb-4">Current Players</h2>
                <div id="playersList" class="space-y-2">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- Site Config -->
            <div class="bg-white p-6 rounded-lg shadow md:col-span-2">
                <h2 class="text-xl font-semibold mb-4">Site Configuration</h2>
                <div id="siteConfig" class="space-y-2">
                    <p>Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testPlayerId = null;

        // Initialize test page
        document.addEventListener('DOMContentLoaded', function() {
            updateDataStatus();
            updatePlayersList();
            updateSiteConfig();
            
            // Listen for data changes
            dataManager.addListener('playerAdded', updatePlayersList);
            dataManager.addListener('playerUpdated', updatePlayersList);
            dataManager.addListener('playerDeleted', updatePlayersList);
            dataManager.addListener('siteConfigUpdated', updateSiteConfig);
        });

        function updateDataStatus() {
            const data = dataManager.data;
            const statusDiv = document.getElementById('dataStatus');
            
            statusDiv.innerHTML = `
                <p><strong>Version:</strong> ${data.version}</p>
                <p><strong>Last Updated:</strong> ${Utils.formatDate(data.lastUpdated)}</p>
                <p><strong>Players:</strong> ${data.players.length}</p>
                <p><strong>Teams:</strong> ${data.teams.length}</p>
                <p><strong>Events:</strong> ${data.events.length}</p>
            `;
        }

        function updatePlayersList() {
            const players = dataManager.getPlayers();
            const playersDiv = document.getElementById('playersList');
            
            if (players.length === 0) {
                playersDiv.innerHTML = '<p class="text-gray-500">No players found</p>';
                return;
            }

            playersDiv.innerHTML = players.map(player => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                    <div>
                        <span class="font-semibold">${player.name}</span>
                        <span class="text-gray-500 ml-2">#${player.number}</span>
                        <span class="text-gray-500 ml-2">${player.position}</span>
                    </div>
                    <div class="text-sm text-gray-500">
                        ${Utils.formatDate(player.createdAt)}
                    </div>
                </div>
            `).join('');
        }

        function updateSiteConfig() {
            const config = dataManager.getSiteConfig();
            const configDiv = document.getElementById('siteConfig');
            
            configDiv.innerHTML = `
                <p><strong>Title:</strong> ${config.title}</p>
                <p><strong>Description:</strong> ${config.description}</p>
                <p><strong>Primary Color:</strong> <span class="inline-block w-4 h-4 rounded" style="background-color: ${config.theme.primary}"></span> ${config.theme.primary}</p>
                <p><strong>Season:</strong> ${config.season.year}</p>
            `;
        }

        function testAddPlayer() {
            try {
                const newPlayer = {
                    name: `Test Player ${Date.now()}`,
                    number: Math.floor(Math.random() * 99) + 1,
                    teamId: 'tigers',
                    position: 'Test Position',
                    image: 'http://static.photos/sport/640x360/test',
                    stats: {
                        battingAverage: 0.300,
                        homeRuns: 2,
                        rbi: 10,
                        gamesPlayed: 5
                    },
                    bio: 'This is a test player created for testing purposes.'
                };

                const player = dataManager.addPlayer(newPlayer);
                testPlayerId = player.id;
                Utils.showNotification('Test player added successfully!', 'success');
                updateDataStatus();
            } catch (error) {
                Utils.showNotification(`Error adding player: ${error.message}`, 'error');
            }
        }

        function testUpdatePlayer() {
            if (!testPlayerId) {
                Utils.showNotification('No test player to update. Add a player first.', 'warning');
                return;
            }

            try {
                const updates = {
                    name: `Updated Player ${Date.now()}`,
                    position: 'Updated Position',
                    stats: {
                        battingAverage: 0.350,
                        homeRuns: 5,
                        rbi: 20,
                        gamesPlayed: 10
                    }
                };

                dataManager.updatePlayer(testPlayerId, updates);
                Utils.showNotification('Test player updated successfully!', 'success');
                updateDataStatus();
            } catch (error) {
                Utils.showNotification(`Error updating player: ${error.message}`, 'error');
            }
        }

        function testDeletePlayer() {
            if (!testPlayerId) {
                Utils.showNotification('No test player to delete. Add a player first.', 'warning');
                return;
            }

            try {
                dataManager.deletePlayer(testPlayerId);
                testPlayerId = null;
                Utils.showNotification('Test player deleted successfully!', 'success');
                updateDataStatus();
            } catch (error) {
                Utils.showNotification(`Error deleting player: ${error.message}`, 'error');
            }
        }

        function testExportData() {
            try {
                const data = dataManager.exportData();
                Utils.downloadJSON(JSON.parse(data), 'teamsite-data.json');
                Utils.showNotification('Data exported successfully!', 'success');
            } catch (error) {
                Utils.showNotification(`Error exporting data: ${error.message}`, 'error');
            }
        }

        function testResetData() {
            Utils.confirm('Are you sure you want to reset all data to defaults? This cannot be undone.', 'Reset Data')
                .then(confirmed => {
                    if (confirmed) {
                        dataManager.resetToDefaults();
                        testPlayerId = null;
                        Utils.showNotification('Data reset to defaults!', 'success');
                        updateDataStatus();
                        updatePlayersList();
                        updateSiteConfig();
                    }
                });
        }
    </script>
</body>
</html>
